# æ¸¬è©¦5.py è»Ÿä»¶æ•¸æ“šä¸Šå‚³åˆ†æ

## è»Ÿä»¶æ—¥èªŒåˆ†æ

æ ¹æ“šæä¾›çš„é‹è¡Œæ—¥èªŒï¼š

### 1. è»Ÿä»¶åŸ·è¡Œæµç¨‹
```
âœ… è»Ÿä»¶æ•¸æ“šä¸Šå‚³å®¢æˆ¶ç«¯å·²è¼‰å…¥
ğŸ”§ é–‹å§‹åˆå§‹åŒ–æ•¸æ“šä¸Šå‚³å™¨...
ğŸ“‹ æ¿€æ´»ç¢¼åˆ—è¡¨: ['SHOW1365']
ğŸ”‘ ä½¿ç”¨æ¿€æ´»ç¢¼: SHOW1365...
âœ… æ•¸æ“šä¸Šå‚³å™¨å·²å•Ÿå‹•
```

### 2. æ¡é›†æ•¸æ“š
```
[20:17:44] é–‹å§‹æ¡é›†æ´»èºç”¨æˆ¶ï¼Œåˆ†ææœ€è¿‘ 50 æ¢æ¶ˆæ¯
[20:17:44] è§£æéˆæ¥: https://t.me/japanfuzoku -> japanfuzoku
[20:17:49] ç™¼ç¾ 17 å€‹æ´»èºç”¨æˆ¶
[20:17:49] å…¶ä¸­ æ©Ÿå™¨äºº:1 èªè­‰ç”¨æˆ¶:0
[20:17:53] æ•¸æ“šå·²å°å‡º: tg_marketing_data\20250712\æ´»èºç”¨æˆ¶_ç„¡é™åˆ¶ç‰ˆ_japanfuzoku_20250712_201753.xlsx
[å¾Œå°] é›²ç«¯ä¸Šå‚³æˆåŠŸ: æˆåŠŸä¸Šå‚³ 16 å€‹æˆå“¡æ•¸æ“š
```

## å•é¡Œè¨ºæ–·

### å¯èƒ½çš„å•é¡ŒåŸå› ï¼š

1. **APIç«¯é»ä¸åŒ¹é…**
   - è»Ÿä»¶å¯èƒ½ä½¿ç”¨äº†éŒ¯èª¤çš„APIç«¯é»
   - æˆ–è€…ä½¿ç”¨äº†èˆŠçš„æ•¸æ“šæ ¼å¼

2. **æ•¸æ“šå­˜å„²ä½ç½®**
   - æ•¸æ“šå¯èƒ½åªå­˜åœ¨æ–‡ä»¶ç³»çµ±ï¼Œæ²’æœ‰é€²å…¥PostgreSQL
   - Railwayå®¹å™¨çš„`uploaded_data`ç›®éŒ„å¯èƒ½æ²’æœ‰æŒä¹…åŒ–

3. **æ•¸æ“šæ ¼å¼å•é¡Œ**
   - è»Ÿä»¶ä¸Šå‚³çš„æ ¼å¼èˆ‡ç¶²ç«™æœŸæœ›çš„æ ¼å¼ä¸åŒ

## è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šåœ¨RailwayåŸ·è¡Œè¨ºæ–·è…³æœ¬

1. å°‡ `check_upload_data.py` ä¸Šå‚³åˆ°Railway
2. åœ¨Railway ShellåŸ·è¡Œï¼š
   ```bash
   python check_upload_data.py
   ```

### æ–¹æ¡ˆ2ï¼šæª¢æŸ¥Railwayæ—¥èªŒ

åœ¨Railwayçš„Deploy Logsä¸­æœç´¢ï¼š
- "æ•¸æ“šä¸Šå‚³æˆåŠŸ"
- "upload_software_data"
- "upload_collection_data"
- "SHOW1365"

### æ–¹æ¡ˆ3ï¼šæ‰‹å‹•æª¢æŸ¥æ•¸æ“š

åœ¨Railway ShellåŸ·è¡Œï¼š
```bash
# æª¢æŸ¥uploaded_dataç›®éŒ„
ls -la uploaded_data/

# æŸ¥çœ‹æœ€æ–°çš„ä¸Šå‚³æ–‡ä»¶
ls -lt uploaded_data/*.json | head -5

# æŸ¥çœ‹æ–‡ä»¶å…§å®¹
cat uploaded_data/software_*.json | head -50

# æª¢æŸ¥PostgreSQL
python -c "
import psycopg2
import os
conn = psycopg2.connect(os.environ.get('DATABASE_URL'))
cur = conn.cursor()
cur.execute('SELECT COUNT(*) FROM activation_codes WHERE code = %s', ('SHOW1365',))
print('SHOW1365æ¿€æ´»ç¢¼:', cur.fetchone())
cur.close()
conn.close()
"
```

## è»Ÿä»¶å¯èƒ½ä½¿ç”¨çš„API

æ ¹æ“šæ—¥èªŒï¼Œè»Ÿä»¶å¯èƒ½èª¿ç”¨äº†ä»¥ä¸‹APIä¹‹ä¸€ï¼š
1. `/api/upload_software_data` - èˆŠç‰ˆAPI
2. `/api/upload_collection_data` - æ–°ç‰ˆAPIï¼ˆæˆ‘å€‘å‰›æ·»åŠ çš„ï¼‰
3. ç›´æ¥å¯«å…¥æ–‡ä»¶ç³»çµ±

## å»ºè­°çš„ä¿®å¾©æ­¥é©Ÿ

1. **ç¢ºèªä¸Šå‚³ç›®éŒ„å­˜åœ¨**
   ```bash
   mkdir -p uploaded_data
   chmod 777 uploaded_data
   ```

2. **æª¢æŸ¥APIèª¿ç”¨æ—¥èªŒ**
   åœ¨ç¶²ç«™ä»£ç¢¼ä¸­æ·»åŠ æ—¥èªŒï¼š
   ```python
   @app.route('/api/upload_collection_data', methods=['POST'])
   def api_upload_collection_data():
       logger.info(f"æ”¶åˆ°æ¡é›†æ•¸æ“šä¸Šå‚³è«‹æ±‚: {request.remote_addr}")
       # ... å…¶ä»–ä»£ç¢¼
   ```

3. **ä½¿ç”¨PostgreSQLå­˜å„²**
   ä¿®æ”¹ä¸Šå‚³é‚è¼¯ï¼Œç›´æ¥å­˜å…¥æ•¸æ“šåº«è€Œä¸æ˜¯æ–‡ä»¶ç³»çµ±

## é©—è­‰æ•¸æ“šæ˜¯å¦ä¸Šå‚³æˆåŠŸ

å¦‚æœæ•¸æ“šç¢ºå¯¦ä¸Šå‚³äº†ï¼Œæ‡‰è©²èƒ½çœ‹åˆ°ï¼š
1. `uploaded_data`ç›®éŒ„ä¸­æœ‰æ–°çš„JSONæ–‡ä»¶
2. æ–‡ä»¶ååŒ…å«`SHOW1365`å’Œæ™‚é–“æˆ³
3. æ–‡ä»¶å…§å®¹åŒ…å«16å€‹æ¡é›†çš„æˆå“¡æ•¸æ“š

æ›´æ–°æ™‚é–“ï¼š2025/07/12 20:50